<!DOCTYPE html>
<html lang="lv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Laivu Rezervācija</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --forest: #0f5c00;
    --moss: #094200;
    --sage: #4d9e2a;
    --water: #0f5c00;
    --sand: #f5f0e8;
    --cream: #fdfaf4;
    --dark: #1a1a1a;
    --error: #c0392b;
    --success: #27ae60;
  }

  body {
    font-family: 'Montserrat', sans-serif;
    background: var(--cream);
    min-height: 100vh;
    color: var(--dark);
  }

  header {
    background: white;
    padding: 16px 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-bottom: 3px solid var(--forest);
    position: relative;
  }

  header img {
    height: 56px;
    width: auto;
  }

  .container {
    max-width: 760px;
    margin: 48px auto;
    padding: 0 24px 80px;
  }

  .form-title {
    font-family: 'Montserrat', sans-serif;
    font-size: 2.2rem;
    font-weight: 700;
    color: var(--forest);
    margin-bottom: 8px;
  }

  .form-subtitle {
    color: #666;
    font-size: 0.95rem;
    margin-bottom: 40px;
  }

  .section {
    background: white;
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 24px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    border: 1px solid rgba(0,0,0,0.06);
  }

  .section-title {
    font-family: 'Montserrat', sans-serif;
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--forest);
    margin-bottom: 24px;
    padding-bottom: 12px;
    border-bottom: 2px solid var(--sand);
  }

  .row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  .row.single { grid-template-columns: 1fr; }

  .field { display: flex; flex-direction: column; gap: 6px; }

  label {
    font-size: 0.85rem;
    font-weight: 500;
    color: #444;
    letter-spacing: 0.3px;
  }

  label .req { color: var(--moss); margin-left: 2px; }

  input, select, textarea {
    padding: 12px 16px;
    border: 1.5px solid #e0e0e0;
    border-radius: 10px;
    font-family: 'Montserrat', sans-serif;
    font-size: 0.95rem;
    color: var(--dark);
    background: white;
    transition: border-color 0.2s, box-shadow 0.2s;
    outline: none;
    width: 100%;
  }

  input:focus, select:focus, textarea:focus {
    border-color: var(--moss);
    box-shadow: 0 0 0 3px rgba(79,127,47,0.1);
  }

  input.error, select.error { border-color: var(--error); }

  textarea { resize: vertical; min-height: 100px; }

  .date-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

  .boat-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 4px;
  }

  .boat-card {
    border: 1.5px solid #e0e0e0;
    border-radius: 12px;
    padding: 16px;
    transition: border-color 0.2s;
  }

  .boat-card:focus-within { border-color: var(--moss); }

  .boat-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
  }

  .boat-name {
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--forest);
  }

  .boat-price {
    font-size: 0.8rem;
    color: var(--water);
    font-weight: 500;
  }

  .boat-desc {
    font-size: 0.78rem;
    color: #888;
    margin-bottom: 10px;
  }

  .boat-card input {
    text-align: center;
    font-size: 1.1rem;
    font-weight: 500;
    padding: 10px;
  }

  .summary-bar {
    background: var(--sand);
    border-radius: 12px;
    padding: 16px 20px;
    display: flex;
    align-items: center;
    margin-top: 20px;
  }

  .summary-item { text-align: center; flex: 1; }
  .summary-label { font-size: 0.78rem; color: #666; margin-bottom: 4px; }
  .summary-value { font-family: 'Montserrat', sans-serif; font-size: 1.3rem; font-weight: 700; color: var(--forest); }

  .availability-bar {
    margin-top: 16px;
    padding: 12px 16px;
    border-radius: 10px;
    font-size: 0.88rem;
    font-weight: 500;
    display: none;
    align-items: center;
    gap: 8px;
  }

  .availability-bar.checking {
    display: flex;
    background: #f0f4ff;
    color: #4a6fa8;
  }

  .availability-bar.ok {
    display: flex;
    background: #e8f5e9;
    color: var(--success);
  }

  .availability-bar.error {
    display: flex;
    background: #fdecea;
    color: var(--error);
  }

  .spinner {
    width: 14px; height: 14px;
    border: 2px solid currentColor;
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
    flex-shrink: 0;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  .submit-btn {
    width: 100%;
    padding: 16px;
    background: var(--forest);
    color: white;
    border: none;
    border-radius: 12px;
    font-family: 'Montserrat', sans-serif;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.2s, transform 0.1s;
    margin-top: 8px;
    letter-spacing: 0.5px;
  }

  .submit-btn:hover { background: var(--moss); }
  .submit-btn:active { transform: scale(0.99); }
  .submit-btn:disabled { background: #aaa; cursor: not-allowed; }

  .success-screen {
    display: none;
    text-align: center;
    padding: 60px 40px;
    background: white;
    border-radius: 16px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.06);
  }

  .success-icon {
    width: 64px; height: 64px;
    background: var(--success);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    margin: 0 auto 24px;
    color: white;
    font-size: 28px;
  }

  .success-screen h2 {
    font-family: 'Montserrat', sans-serif;
    font-size: 1.8rem;
    color: var(--forest);
    margin-bottom: 12px;
  }

  .success-screen p { color: #666; line-height: 1.6; }

  .field-error {
    font-size: 0.78rem;
    color: var(--error);
    margin-top: 2px;
  }

  @media (max-width: 600px) {
    .row, .boat-row, .date-row { grid-template-columns: 1fr; }
    header { padding: 16px 20px; }
    .section { padding: 20px; }
    .container { margin: 24px auto; }
  }

  .lang-select-wrap {
    position: absolute;
    right: 24px;
    top: 50%;
    transform: translateY(-50%);
  }
  .lang-select-btn {
    display: flex;
    align-items: center;
    gap: 7px;
    background: var(--sand);
    border: 1.5px solid var(--forest);
    border-radius: 8px;
    padding: 6px 10px;
    cursor: pointer;
    color: var(--forest);
    font-family: 'Montserrat', sans-serif;
    font-size: 0.82rem;
    font-weight: 600;
  }
  .lang-select-btn:hover { background: #e8f0e4; }
  .lang-dropdown-menu {
    position: absolute;
    right: 0;
    top: calc(100% + 6px);
    background: white;
    border: 1.5px solid #e0e0e0;
    border-radius: 10px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    overflow: hidden;
    display: none;
    min-width: 160px;
    z-index: 999;
    /* ensure it never goes off screen to the right */
    right: auto;
    left: 50%;
    transform: translateX(-50%);
  }
  .lang-dropdown-menu.open { display: block; }
  .lang-option {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    cursor: pointer;
    font-size: 0.85rem;
    font-family: 'Montserrat', sans-serif;
    transition: background 0.1s;
  }
  .lang-option:hover { background: #f5f5f5; }
  .lang-option.active { background: #f0f7ec; font-weight: 600; color: #0f5c00; }

  .phone-wrapper {
    display: flex;
    gap: 0;
    border: 1.5px solid #e0e0e0;
    border-radius: 10px;
    overflow: hidden;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .phone-wrapper:focus-within {
    border-color: #094200;
    box-shadow: 0 0 0 3px rgba(15,92,0,0.1);
  }
  .phone-prefix-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 10px 12px;
    background: #f9f9f9;
    border: none;
    border-right: 1.5px solid #e0e0e0;
    cursor: pointer;
    font-family: 'Montserrat', sans-serif;
    font-size: 0.88rem;
    font-weight: 500;
    color: #333;
    white-space: nowrap;
    flex-shrink: 0;
  }
  .phone-prefix-btn:hover { background: #f0f0f0; }
  .phone-prefix-btn svg { flex-shrink: 0; }
  .phone-wrapper input {
    border: none !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    flex: 1;
    min-width: 0;
  }
  .phone-wrapper input:focus { box-shadow: none !important; }
  .prefix-dropdown {
    position: absolute;
    top: calc(100% + 4px);
    left: 0;
    background: white;
    border: 1.5px solid #e0e0e0;
    border-radius: 10px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    z-index: 999;
    width: 280px;
    max-height: 300px;
    overflow-y: auto;
    display: none;
  }
  .prefix-dropdown.open { display: block; }
  .prefix-search {
    padding: 10px 12px;
    border-bottom: 1px solid #eee;
    position: sticky;
    top: 0;
    background: white;
  }
  .prefix-search input {
    width: 100%;
    border: 1px solid #ddd !important;
    border-radius: 6px !important;
    padding: 6px 10px !important;
    font-size: 0.85rem !important;
  }
  .prefix-option {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 9px 14px;
    cursor: pointer;
    font-size: 0.88rem;
    transition: background 0.1s;
  }
  .prefix-option:hover { background: #f5f5f5; }
  .prefix-option .code { color: #888; font-size: 0.8rem; margin-left: auto; }
  .phone-field-wrap { position: relative; }
  /* Custom datepicker */
  .datepicker-wrap { position: relative; }
  .datepicker-btn {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 16px;
    border: 1.5px solid #e0e0e0;
    border-radius: 10px;
    background: white;
    font-family: 'Montserrat', sans-serif;
    font-size: 0.95rem;
    color: var(--dark);
    cursor: pointer;
    text-align: left;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .datepicker-btn:hover { border-color: #ccc; }
  .datepicker-btn.has-value { border-color: var(--moss); }
  .datepicker-btn.has-value:focus, .datepicker-btn:focus {
    border-color: var(--moss);
    box-shadow: 0 0 0 3px rgba(79,127,47,0.1);
    outline: none;
  }
  .datepicker-btn span { flex: 1; }
  .datepicker-btn .placeholder { color: #aaa; }

  .cal-popup {
    display: none;
    position: absolute;
    top: calc(100% + 6px);
    left: 0;
    background: white;
    border: 1.5px solid #e0e0e0;
    border-radius: 14px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.12);
    z-index: 1000;
    padding: 16px;
    width: 280px;
    font-family: 'Montserrat', sans-serif;
  }
  .cal-popup.open { display: block; }

  .cal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 14px;
  }
  .cal-nav {
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 6px;
    color: var(--forest);
    font-size: 1rem;
    transition: background 0.15s;
    display: flex; align-items: center;
  }
  .cal-nav:hover { background: var(--sand); }
  .cal-month-label {
    font-weight: 700;
    font-size: 0.92rem;
    color: var(--forest);
    cursor: pointer;
  }
  .cal-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 2px;
  }
  .cal-dow {
    text-align: center;
    font-size: 0.7rem;
    font-weight: 600;
    color: #999;
    padding: 4px 0 8px;
    text-transform: uppercase;
  }
  .cal-day {
    text-align: center;
    padding: 7px 2px;
    font-size: 0.82rem;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.12s, color 0.12s;
    font-weight: 500;
  }
  .cal-day:hover:not(.disabled):not(.empty) { background: var(--sand); }
  .cal-day.today { color: var(--forest); font-weight: 700; }
  .cal-day.selected { background: var(--forest); color: white; font-weight: 700; border-radius: 8px; }
  .cal-day.disabled { color: #ddd; cursor: default; }
  .cal-day.empty { cursor: default; }
  .cal-day.in-range { background: #e8f5e0; border-radius: 0; }
  .cal-day.range-start { background: var(--forest); color: white; border-radius: 8px 0 0 8px; }
  .cal-day.range-end { background: var(--forest); color: white; border-radius: 0 8px 8px 0; }
  .cal-day.range-start.range-end { border-radius: 8px; }
  .return-btn {
    display: inline-block;
    margin-top: 28px;
    padding: 13px 32px;
    background: var(--forest);
    color: white;
    border-radius: 12px;
    font-family: 'Montserrat', sans-serif;
    font-size: 0.95rem;
    font-weight: 700;
    text-decoration: none;
    transition: background 0.2s;
  }
  .return-btn:hover { background: var(--moss); }
</style>
</head>
<body>

<header>
  <img src="mucas-logo.png" alt="Mucas logo">
  <div class="lang-select-wrap">
    <button class="lang-select-btn" onclick="toggleLangMenu()" id="langSelectBtn">
      <span id="currentLangFlag"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="30" fill="#9e3039"/><rect width="60" height="10" y="10" fill="#fff"/></svg></span>
      <span id="currentLangName">LV</span>
      <svg width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1l4 4 4-4" stroke="#0f5c00" stroke-width="1.5" stroke-linecap="round"/></svg>
    </button>
    <div class="lang-dropdown-menu" id="langDropdownMenu">
      <div class="lang-option active" onclick="setLang('lv')"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px;flex-shrink:0"><rect width="60" height="30" fill="#9e3039"/><rect width="60" height="10" y="10" fill="#fff"/></svg> Latviešu</div>
      <div class="lang-option" onclick="setLang('en')"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px;flex-shrink:0"><rect width="60" height="30" fill="#012169"/><path d="M0 0l60 30M60 0L0 30" stroke="#fff" stroke-width="6"/><path d="M0 0l60 30M60 0L0 30" stroke="#C8102E" stroke-width="4"/><rect width="8" height="30" x="26" fill="#fff"/><rect width="60" height="8" y="11" fill="#fff"/><rect width="4" height="30" x="28" fill="#C8102E"/><rect width="60" height="4" y="13" fill="#C8102E"/></svg> English</div>
      <div class="lang-option" onclick="setLang('lt')"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px;flex-shrink:0"><rect width="60" height="10" fill="#fdb921"/><rect width="60" height="10" y="10" fill="#006a44"/><rect width="60" height="10" y="20" fill="#c1272d"/></svg> Lietuvių</div>
      <div class="lang-option" onclick="setLang('et')"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px;flex-shrink:0"><rect width="60" height="10" fill="#0072ce"/><rect width="60" height="10" y="10" fill="#000"/><rect width="60" height="10" y="20" fill="#fff"/></svg> Eesti</div>
      <div class="lang-option" onclick="setLang('fi')"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px;flex-shrink:0"><rect width="60" height="30" fill="#fff"/><rect width="8" height="30" x="14" fill="#003580"/><rect width="60" height="8" y="11" fill="#003580"/></svg> Suomi</div>
    </div>
  </div>
</header>

<div class="container">
  <h2 class="form-title" data-lv="Laivu rezervācijas forma" data-en="Boat Reservation Form" data-et="Paatide reserveerimise vorm" data-fi="Veneiden varauslomake" data-lt="Valčių rezervacijos forma">Laivu rezervācijas forma</h2>
  <p class="form-subtitle" data-lv="Aizpildiet formu, lai rezervētu laivas jūsu piedzīvojumam uz upes." data-en="Fill in the form to reserve boats for your river adventure." data-et="Täitke vorm, et broneerida paadid oma jõeseikluseks." data-fi="Täytä lomake varataksesi veneet jokiseikkailuasi varten." data-lt="Užpildykite formą, kad rezervuotumėte valtis savo upės nuotoliui.">Aizpildiet formu, lai rezervētu laivas jūsu piedzīvojumam uz upes.</p>

  <form id="bookingForm">

    <!-- Contact -->
    <div class="section">
      <div class="section-title" data-lv="Jūsu kontaktinformācija" data-en="Your Contact Information" data-et="Teie kontaktandmed" data-fi="Yhteystietosi" data-lt="Jūsų kontaktinė informacija">Jūsu kontaktinformācija</div>
      <div class="row" style="margin-bottom:20px">
        <div class="field">
          <label data-lv="Vārds" data-en="First Name" data-et="Eesnimi" data-fi="Etunimi" data-lt="Vardas">Vārds <span class="req">*</span></label>
          <input type="text" id="firstName" placeholder="Jānis" required>
        </div>
        <div class="field">
          <label data-lv="Uzvārds" data-en="Last Name" data-et="Perekonnanimi" data-fi="Sukunimi" data-lt="Pavardė">Uzvārds <span class="req">*</span></label>
          <input type="text" id="lastName" placeholder="Bērziņš" required>
        </div>
      </div>
      <div class="row">
        <div class="field">
          <label data-lv="E-pasts" data-en="Email" data-et="E-post" data-fi="Sähköposti" data-lt="El. paštas">E-pasts <span class="req">*</span></label>
          <input type="email" id="email" placeholder="janis@inbox.lv" required>
        </div>
        <div class="field">
          <label data-lv="Tālrunis" data-en="Phone" data-et="Telefon" data-fi="Puhelin" data-lt="Telefonas">Tālrunis <span class="req">*</span></label>
          <div class="phone-field-wrap">
            <div class="phone-wrapper">
              <button type="button" class="phone-prefix-btn" id="prefixBtn" onclick="togglePrefixDropdown()">
                <span id="prefixFlag"></span>
                <span id="prefixCode">+371</span>
                <svg width="10" height="6" viewBox="0 0 10 6" fill="none"><path d="M1 1l4 4 4-4" stroke="#666" stroke-width="1.5" stroke-linecap="round"/></svg>
              </button>
              <input type="tel" id="phone" placeholder="20000000" required>
            </div>
            <div class="prefix-dropdown" id="prefixDropdown">
              <div class="prefix-search"><input type="text" id="prefixSearch" placeholder="Search country..." oninput="filterCountries(this.value)"></div>
              <div id="prefixList"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Booking Details -->
    <div class="section">
      <div class="section-title" data-lv="Rezervācijas detaļas" data-en="Reservation Details" data-et="Broneeringu üksikasjad" data-fi="Varauksen tiedot" data-lt="Rezervacijos detalės">Rezervācijas detaļas</div>

      <div class="row" style="margin-bottom:20px">
        <div class="field">
          <label data-lv="Izvēlaties upi" data-en="Select River" data-et="Valige jõgi" data-fi="Valitse joki" data-lt="Pasirinkite upę">Izvēlaties upi <span class="req">*</span></label>
          <select id="river" required>
            <option value="">— Izvēlieties upi —</option>
          </select>
        </div>
        <div class="field">
          <label data-lv="Izvēlaties maršrutu" data-en="Select Route" data-et="Valige marsruut" data-fi="Valitse reitti" data-lt="Pasirinkite maršrutą">Izvēlaties maršrutu <span class="req">*</span></label>
          <select id="route" required disabled>
            <option value="">— Vispirms izvēlieties upi —</option>
          </select>
        </div>
      </div>

      <div class="row single" style="margin-bottom:20px">
        <div class="field">
          <label data-lv="Vēlamais sākuma laiks" data-en="Preferred Start Time" data-et="Eelistatud algusaeg" data-fi="Toivottu lähtöaika" data-lt="Pageidaujamas pradžios laikas">Vēlamais sākuma laiks</label>
          <select id="startTime">
            <option value="09:00">09:00</option>
            <option value="11:00" selected>11:00</option>
            <option value="13:00">13:00</option>
            <option value="15:00">15:00</option>
            <option value="cits" data-lv="Cits laiks" data-en="Other time" data-et="Muu aeg" data-fi="Muu aika" data-lt="Kitas laikas">Cits laiks</option>
          </select>
        </div>
      </div>

      <div class="field" style="margin-bottom:20px">
        <label data-lv="Datumi" data-en="Dates" data-et="Kuupäevad" data-fi="Päivämäärät" data-lt="Datos">Datumi <span class="req">*</span></label>
        <small style="color:#888;font-size:0.78rem;margin-bottom:6px;display:block;" data-lv="Vienas dienas braucienam izvēlieties sākuma un beigu datumu vienādu." data-en="For a one-day trip, select the same date for both start and end." data-et="Ühepäevase sõidu puhul valige sama kuupäev algus- ja lõppkuupäevaks." data-fi="Yhden päivän retkelle valitse sama päivämäärä alku- ja loppupäiväksi." data-lt="Vienos dienos kelionei pasirinkite tą pačią pradžios ir pabaigos datą.">Vienas dienas braucienam izvēlieties sākuma un beigu datumu vienādu.</small>
        <div class="date-row">
          <div class="field">
            <div class="datepicker-wrap" id="startDateWrap">
              <button type="button" class="datepicker-btn" id="startDateBtn" onclick="toggleCal('start')">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="2" width="14" height="13" rx="2" stroke="#0f5c00" stroke-width="1.5"/><path d="M1 6h14" stroke="#0f5c00" stroke-width="1.5"/><path d="M5 1v2M11 1v2" stroke="#0f5c00" stroke-width="1.5" stroke-linecap="round"/></svg>
                <span id="startDateDisplay" data-lv="Izvēlieties datumu" data-en="Select date" data-et="Valige kuupäev" data-fi="Valitse päivä" data-lt="Pasirinkite datą">Izvēlieties datumu</span>
              </button>
              <div class="cal-popup" id="startCal"></div>
            </div>
            <input type="hidden" id="startDate" required>
            <small style="color:#888;font-size:0.78rem;margin-top:4px" data-lv="Sākuma datums" data-en="Start Date" data-et="Alguskuupäev" data-fi="Alkupäivä" data-lt="Pradžios data">Sākuma datums</small>
          </div>
          <div class="field">
            <div class="datepicker-wrap" id="endDateWrap">
              <button type="button" class="datepicker-btn" id="endDateBtn" onclick="toggleCal('end')">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="2" width="14" height="13" rx="2" stroke="#0f5c00" stroke-width="1.5"/><path d="M1 6h14" stroke="#0f5c00" stroke-width="1.5"/><path d="M5 1v2M11 1v2" stroke="#0f5c00" stroke-width="1.5" stroke-linecap="round"/></svg>
                <span id="endDateDisplay" data-lv="Izvēlieties datumu" data-en="Select date" data-et="Valige kuupäev" data-fi="Valitse päivä" data-lt="Pasirinkite datą">Izvēlieties datumu</span>
              </button>
              <div class="cal-popup" id="endCal"></div>
            </div>
            <input type="hidden" id="endDate" required>
            <small style="color:#888;font-size:0.78rem;margin-top:4px" data-lv="Beigu datums" data-en="End Date" data-et="Lõppkuupäev" data-fi="Loppupäivä" data-lt="Pabaigos data">Beigu datums</small>
          </div>
        </div>
      </div>

      <div class="field" id="boatSection" style="display:none">
        <label data-lv="Laivas" data-en="Boats" data-et="Paadid" data-fi="Veneet" data-lt="Valtys">Laivas <span class="req">*</span></label>
        <div class="boat-row">

          <div class="boat-card" id="card-kayak" style="display:none">
            <div class="boat-card-header">
              <div class="boat-name">Kajaks Vista</div>
              <div class="boat-price">€30/dienā</div>
            </div>
            <div class="boat-desc" data-lv="2-vietīga" data-en="2-seater" data-et="2-kohaline" data-fi="2-paikkainen" data-lt="2-vietė">2-vietīga</div>
            <input type="number" id="kayaks" min="0" value="0" placeholder="0">
          </div>

          <div class="boat-card" id="card-canoe" style="display:none">
            <div class="boat-card-header">
              <div class="boat-name">Kanoe Loksija</div>
              <div class="boat-price">€30/dienā</div>
            </div>
            <div class="boat-desc" data-lv="3-vietīga" data-en="3-seater" data-et="3-kohaline" data-fi="3-paikkainen" data-lt="3-vietė">3-vietīga</div>
            <input type="number" id="canoes" min="0" value="0" placeholder="0">
          </div>

          <div class="boat-card" id="card-raft" style="display:none">
            <div class="boat-card-header">
              <div class="boat-name">Plosts</div>
              <div class="boat-price">€X/dienā</div>
            </div>
            <div class="boat-desc" data-lv="10-vietīgs" data-en="10-seater" data-et="10-kohaline" data-fi="10-paikkainen" data-lt="10-vietė">10-vietīgs</div>
            <input type="number" id="rafts" min="0" value="0" placeholder="0">
          </div>

        </div>
      </div>

      <div class="availability-bar" id="availabilityBar">
        <div class="spinner" id="availSpinner" style="display:none"></div>
        <span id="availText"></span>
      </div>

      <div class="summary-bar">
        <div class="summary-item">
          <div class="summary-label" data-lv="Kopējais cilvēku skaits" data-en="Total People" data-et="Inimeste arv kokku" data-fi="Henkilöitä yhteensä" data-lt="Iš viso žmonių">Kopējais cilvēku skaits</div>
          <div class="summary-value" id="totalSeats">0</div>
        </div>
        <div class="summary-item">
          <div class="summary-label" data-lv="Dienas" data-en="Days" data-et="Päevad" data-fi="Päivät" data-lt="Dienos">Dienas</div>
          <div class="summary-value" id="totalDays">—</div>
        </div>
        <div class="summary-item">
          <div class="summary-label" data-lv="Cena" data-en="Price" data-et="Hind" data-fi="Hinta" data-lt="Kaina">Cena</div>
          <div class="summary-value" id="totalPrice">€0</div>
        </div>
      </div>
    </div>

    <!-- Notes -->
    <div class="section">
      <div class="section-title" data-lv="Papildu informācija" data-en="Additional Information" data-et="Lisateave" data-fi="Lisätiedot" data-lt="Papildoma informacija">Papildu informācija</div>
      <div class="field">
        <label data-lv="Komentāri vai jautājumi" data-en="Comments or Questions" data-et="Kommentaarid või küsimused" data-fi="Kommentit tai kysymykset" data-lt="Komentarai ar klausimai">Komentāri vai jautājumi</label>
        <textarea id="notes" placeholder="Jebkāda papildu informācija..."></textarea>
      </div>
    </div>

    <div style="background:#f0f4ed;border-left:3px solid var(--forest);border-radius:8px;padding:16px 20px;margin-bottom:16px;font-size:0.85rem;color:#444;line-height:1.6;">
      <strong style="color:var(--forest);display:block;margin-bottom:4px;" data-lv="Kā notiek rezervācija?" data-en="How does the reservation work?" data-et="Kuidas broneerimine toimib?" data-fi="Miten varaus toimii?" data-lt="Kaip veikia rezervacija?">Kā notiek rezervācija?</strong>
      <span data-lv="Pēc pieteikuma iesniegšanas mēs to izskatīsim un sazināsimies ar jums tuvākajā laikā. Jūs saņemsiet e-pasta apstiprinājumu ar maksājuma norādījumiem vai zvanu no mums, lai vienotos par detaļām." data-en="Once your request is submitted, we will review it and get back to you shortly. You will receive an email confirmation with payment instructions, or a call from us to sort out the details." data-et="Pärast taotluse esitamist vaatame selle läbi ja võtame teiega peagi ühendust. Saate e-posti kinnituse maksejuhistega või helistame teile üksikasjade kokkuleppimiseks." data-fi="Lähetyksen jälkeen käymme hakemuksesi läpi ja otamme sinuun yhteyttä pian. Saat sähköpostivahvistuksen maksutiedoilla tai soitamme sinulle yksityiskohtien sopimiseksi." data-lt="Pateikus užklausą, mes ją peržiūrėsime ir netrukus susisieksime su jumis. Gausite el. pašto patvirtinimą su mokėjimo instrukcijomis arba skambutį iš mūsų.">Pēc pieteikuma iesniegšanas mēs to izskatīsim un sazināsimies ar jums tuvākajā laikā. Jūs saņemsiet e-pasta apstiprinājumu ar maksājuma norādījumiem vai zvanu no mums, lai vienotos par detaļām.</span>
    </div>
    <button type="submit" class="submit-btn" id="submitBtn" data-lv="Rezervēt" data-en="Book Now" data-et="Broneeri" data-fi="Varaa" data-lt="Rezervuoti">Rezervēt</button>
  </form>

  <div class="success-screen" id="successScreen">
    <div class="success-icon">✓</div>
    <h2 data-lv="Paldies par rezervāciju!" data-en="Thank you for your reservation!" data-et="Täname broneeringu eest!" data-fi="Kiitos varauksestasi!" data-lt="Ačiū už rezervaciją!">Paldies par rezervāciju!</h2>
    <p><span data-lv="Mēs saņēmām jūsu pieteikumu un sazināsimies ar jums tuvākajā laikā, lai apstiprinātu rezervāciju." data-en="We have received your request and will be in touch shortly to confirm your reservation." data-et="Oleme teie taotluse kätte saanud ja võtame teiega peagi ühendust, et broneeringu kinnitada." data-fi="Olemme vastaanottaneet hakemuksesi ja otamme sinuun pian yhteyttä vahvistaaksemme varauksen." data-lt="Gavome jūsų užklausą ir netrukus susisieksime, kad patvirtintume rezervaciją.">Mēs saņēmām jūsu pieteikumu un sazināsimies ar jums tuvākajā laikā, lai apstiprinātu rezervāciju.</span><br><br>
    <span data-lv="Pārbaudiet savu e-pastu" data-en="Check your email" data-et="Kontrollige oma e-posti" data-fi="Tarkista sähköpostisi" data-lt="Patikrinkite savo el. paštą">Pārbaudiet savu e-pastu</span> <strong id="confirmEmail"></strong></p>
    <a href="http://www.laivunoma.com/" class="return-btn" data-lv="Atgriezties uz vietni" data-en="Return to website" data-et="Tagasi veebisaidile" data-fi="Palaa verkkosivustolle" data-lt="Grįžti į svetainę">Atgriezties uz vietni</a>
  </div>
</div>

<script>
const API_BASE = 'https://boat-availability.vercel.app/api';

let allRivers = [];
let allRoutes = [];
let boatTypeMap = {};

async function loadFormData() {
  try {
    const res = await fetch(API_BASE + '/get-form-data');
    const data = await res.json();
    allRivers = data.rivers || [];
    allRoutes = data.routes || [];
    boatTypeMap = data.boatTypeMap || {};

    const riverEl = document.getElementById('river');
    riverEl.innerHTML = '<option value="">-- Izveleties upi --</option>';
    allRivers.forEach(r => {
      riverEl.innerHTML += '<option value="' + r.id + '">' + r.name + '</option>';
    });
  } catch(e) {
    console.error('Failed to load form data', e);
  }
}

function updateBoatCards(riverId) {
  const river = allRivers.find(r => r.id === riverId);
  const types = (river && river.boatTypes && river.boatTypes.length > 0) ? river.boatTypes : ['kayaks', 'canoes'];

  // Map each card id to its Airtable key
  const cardMap = {
    'card-kayak': 'kajaks vista',
    'card-canoe': 'kanoe loksija',
    'card-raft':  'rafts'
  };
  // Which types show which card
  const typeToCard = {
    'kayaks': 'card-kayak',
    'canoes': 'card-canoe',
    'rafts':  'card-raft'
  };

  // Hide all first, reset values
  Object.keys(cardMap).forEach(cardId => {
    const el = document.getElementById(cardId);
    el.style.display = 'none';
    const input = el.querySelector('input[type=number]');
    if (input) input.value = 0;
  });

  // Show and populate relevant cards
  types.forEach(type => {
    const cardId = typeToCard[type];
    if (!cardId) return;
    const el = document.getElementById(cardId);
    const btKey = cardMap[cardId];
    const bt = boatTypeMap[btKey] || {};

    // Update name
    const nameEl = el.querySelector('.boat-name');
    if (nameEl && bt.name) nameEl.textContent = bt.name;

    // Update price
    const priceEl = el.querySelector('.boat-price');
    if (priceEl && bt.price) priceEl.textContent = '€' + bt.price + '/dienā';

    // Update capacity description
    const descEl = el.querySelector('.boat-desc');
    if (descEl && bt.capacity) descEl.textContent = bt.capacity + '-vietīgs';

    el.style.display = 'block';
  });

  document.getElementById('boatSection').style.display = riverId ? 'block' : 'none';
}

loadFormData();

const riverEl = document.getElementById('river');
const routeEl = document.getElementById('route');
const totalSeatsEl = document.getElementById('totalSeats');
const totalDaysEl = document.getElementById('totalDays');
const totalPriceEl = document.getElementById('totalPrice');
const availBar = document.getElementById('availabilityBar');
const availText = document.getElementById('availText');
const availSpinner = document.getElementById('availSpinner');
const submitBtn = document.getElementById('submitBtn');

const today = new Date();
today.setHours(0,0,0,0);

// ── Custom Calendar ──────────────────────────────────────────
const calState = {
  start: { year: today.getFullYear(), month: today.getMonth(), value: null },
  end:   { year: today.getFullYear(), month: today.getMonth(), value: null },
  open: null
};

const DOW = ['Su','Mo','Tu','We','Th','Fr','Sa'];
const MONTHS = ['January','February','March','April','May','June','July','August','September','October','November','December'];

function fmt(d) {
  if (!d) return '';
  return d.getDate() + '.' + (d.getMonth()+1) + '.' + d.getFullYear();
}
function toISO(d) {
  if (!d) return '';
  return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0');
}

function renderCal(which) {
  const s = calState[which];
  const popup = document.getElementById(which + 'Cal');
  const firstDay = new Date(s.year, s.month, 1).getDay();
  const daysInMonth = new Date(s.year, s.month+1, 0).getDate();
  const startVal = calState.start.value;
  const endVal = calState.end.value;

  let html = `<div class="cal-header">
    <button type="button" class="cal-nav" onclick="calNav('${which}',-1)">&#8249;</button>
    <span class="cal-month-label">${MONTHS[s.month]} ${s.year}</span>
    <button type="button" class="cal-nav" onclick="calNav('${which}',1)">&#8250;</button>
  </div><div class="cal-grid">`;

  DOW.forEach(d => { html += `<div class="cal-dow">${d}</div>`; });

  for (let i = 0; i < firstDay; i++) html += `<div class="cal-day empty"></div>`;

  for (let d = 1; d <= daysInMonth; d++) {
    const date = new Date(s.year, s.month, d);
    date.setHours(0,0,0,0);
    const isPast = date < today;
    const isToday = date.getTime() === today.getTime();
    const isStart = startVal && date.getTime() === startVal.getTime();
    const isEnd = endVal && date.getTime() === endVal.getTime();
    const inRange = startVal && endVal && date > startVal && date < endVal;

    let cls = 'cal-day';
    if (isPast) cls += ' disabled';
    if (isToday) cls += ' today';
    if (isStart && isEnd) cls += ' selected range-start range-end';
    else if (isStart) cls += ' range-start';
    else if (isEnd) cls += ' range-end';
    else if (inRange) cls += ' in-range';

    const onclick = isPast ? '' : `onclick="calPick('${which}',${s.year},${s.month},${d})"`;
    html += `<div class="${cls}" ${onclick}>${d}</div>`;
  }

  html += '</div>';
  popup.innerHTML = html;
}

function calNav(which, dir) {
  const s = calState[which];
  s.month += dir;
  if (s.month > 11) { s.month = 0; s.year++; }
  if (s.month < 0)  { s.month = 11; s.year--; }
  renderCal(which);
}

function calPick(which, year, month, day) {
  const date = new Date(year, month, day);
  calState[which].value = date;

  // Update display button
  const btn = document.getElementById(which + 'DateBtn');
  const span = document.getElementById(which + 'DateDisplay');
  span.textContent = fmt(date);
  span.classList.remove('placeholder');
  btn.classList.add('has-value');

  // Update hidden input & trigger events
  const hidden = document.getElementById(which + 'Date');
  hidden.value = toISO(date);
  hidden.dispatchEvent(new Event('change'));

  // If picking start and it's after end, clear end
  if (which === 'start' && calState.end.value && date > calState.end.value) {
    calState.end.value = null;
    document.getElementById('endDateDisplay').textContent = document.getElementById('endDateDisplay').getAttribute('data-' + (window.currentLang||'lv'));
    document.getElementById('endDateBtn').classList.remove('has-value');
    document.getElementById('endDate').value = '';
  }

  closeCals();
  // Re-render both to show range highlight
  renderCal('start');
  renderCal('end');
}

function toggleCal(which) {
  const popup = document.getElementById(which + 'Cal');
  const isOpen = popup.classList.contains('open');
  closeCals();
  if (!isOpen) {
    renderCal(which);
    popup.classList.add('open');
    calState.open = which;
  }
}

function closeCals() {
  document.getElementById('startCal').classList.remove('open');
  document.getElementById('endCal').classList.remove('open');
  calState.open = null;
}

document.addEventListener('click', e => {
  if (!e.target.closest('.datepicker-wrap')) closeCals();
});

riverEl.addEventListener('change', () => {
  const riverId = riverEl.value;
  routeEl.innerHTML = '<option value="">-- Izveleties marsrutu --</option>';
  routeEl.disabled = !riverId;
  if (riverId) {
    const riverRoutes = allRoutes.filter(r => r.riverId === riverId);
    riverRoutes.forEach(r => {
      routeEl.innerHTML += '<option value="' + r.id + '" data-hub="' + r.hubName + '">' + r.name + '</option>';
    });
  }
  updateBoatCards(riverId);
  resetAvailability();
});

routeEl.addEventListener('change', () => { checkAvailability(); });
document.getElementById('startDate').addEventListener('change', () => { updateSummary(); checkAvailability(); });
document.getElementById('endDate').addEventListener('change', () => { updateSummary(); checkAvailability(); });
document.getElementById('kayaks').addEventListener('input', () => { updateSummary(); checkAvailability(); });
document.getElementById('canoes').addEventListener('input', () => { updateSummary(); checkAvailability(); });
document.getElementById('rafts').addEventListener('input',  () => { updateSummary(); checkAvailability(); });

function getDays() {
  const sv = document.getElementById('startDate').value;
  const ev = document.getElementById('endDate').value;
  if (!sv || !ev) return 0;
  const start = new Date(sv);
  const end = new Date(ev);
  return Math.round((end - start) / 86400000) + 1;
}

function getSelectedHub() {
  const opt = routeEl.options[routeEl.selectedIndex];
  return opt ? opt.getAttribute('data-hub') : '';
}

function updateSummary() {
  const kayaks = parseInt(document.getElementById('kayaks').value) || 0;
  const canoes = parseInt(document.getElementById('canoes').value) || 0;
  const rafts  = parseInt(document.getElementById('rafts').value)  || 0;
  const days = getDays();

  const kayakPrice = (boatTypeMap['kajaks vista'] || {}).price || 30;
  const canoePrice = (boatTypeMap['kanoe loksija'] || {}).price || 30;
  const raftPrice  = (boatTypeMap['rafts'] || {}).price || 30;
  const kayakCap   = (boatTypeMap['kajaks vista'] || {}).capacity || 2;
  const canoeCap   = (boatTypeMap['kanoe loksija'] || {}).capacity || 3;
  const raftCap    = (boatTypeMap['rafts'] || {}).capacity || 6;

  totalSeatsEl.textContent = kayaks * kayakCap + canoes * canoeCap + rafts * raftCap;
  totalDaysEl.textContent = days > 0 ? days : '--';
  const total = (kayaks * kayakPrice + canoes * canoePrice + rafts * raftPrice) * (days > 0 ? days : 0);
  totalPriceEl.textContent = '€' + total;
}

let availTimer = null;
function checkAvailability() {
  clearTimeout(availTimer);
  availTimer = setTimeout(_checkAvailability, 600);
}

async function _checkAvailability() {
  const hub = getSelectedHub();
  const kayaks = parseInt(document.getElementById('kayaks').value) || 0;
  const canoes = parseInt(document.getElementById('canoes').value) || 0;
  const rafts  = parseInt(document.getElementById('rafts').value)  || 0;
  const startVal = document.getElementById('startDate').value;
  const endVal = document.getElementById('endDate').value;
  if (!hub || !startVal || !endVal || (kayaks + canoes + rafts) === 0) { resetAvailability(); return; }

  availBar.className = 'availability-bar checking';
  availSpinner.style.display = 'block';
  availText.textContent = window.currentLang === 'en' ? 'Checking availability...' : 'Pārbaudam pieejamību...';
  try {
    const url = API_BASE + '/check-availability?hub=' + encodeURIComponent(hub) + '&start_date=' + startVal + '&end_date=' + endVal;
    const res = await fetch(url);
    const data = await res.json();
    availSpinner.style.display = 'none';
    const enoughKayaks = (data.available_kayaks ?? 999) >= kayaks;
    const enoughCanoes = (data.available_canoes ?? 999) >= canoes;
    const enoughRafts  = (data.available_rafts  ?? 999) >= rafts;
    if (enoughKayaks && enoughCanoes && enoughRafts) {
      availBar.className = 'availability-bar ok';
      availText.textContent = window.currentLang === 'en' ? 'Available!' : 'Pieejams!';
      submitBtn.disabled = false;
    } else {
      availBar.className = 'availability-bar error';
      availText.textContent = window.currentLang === 'en' ? 'Not enough boats available.' : 'Nav pietiekami brīvo laivu.';
      submitBtn.disabled = true;
    }
  } catch(e) {
    availSpinner.style.display = 'none';
    availBar.className = 'availability-bar error';
    availText.textContent = window.currentLang === 'en' ? 'Could not check availability. Please try again.' : 'Neizdevās pārbaudīt pieejamību. Lūdzu, mēģiniet vēlreiz.';
  }
}

function resetAvailability() {
  availBar.className = 'availability-bar';
  submitBtn.disabled = false;
}

document.getElementById('bookingForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  submitBtn.disabled = true;
  submitBtn.textContent = window.currentLang === 'en' ? 'Sending...' : 'Sūta...';
  try {
    const res = await fetch(API_BASE + '/submit-booking', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        firstName: document.getElementById('firstName').value,
        lastName: document.getElementById('lastName').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('prefixCode').textContent + ' ' + document.getElementById('phone').value,
        riverId: riverEl.value,
        routeId: routeEl.value,
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value,
        kayaks: parseInt(document.getElementById('kayaks').value) || 0,
        canoes: parseInt(document.getElementById('canoes').value) || 0,
        rafts:  parseInt(document.getElementById('rafts').value)  || 0,
        startTime: document.getElementById('startTime').value,
        notes: document.getElementById('notes').value
      })
    });
    const data = await res.json();
    if (res.ok && data.success) {
      document.getElementById('bookingForm').style.display = 'none';
      document.getElementById('successScreen').style.display = 'block';
      document.getElementById('confirmEmail').textContent = document.getElementById('email').value;
    } else {
      alert('Kludaa: ' + (data.error || 'Nezinama kludaa'));
      submitBtn.disabled = false;
      submitBtn.textContent = window.currentLang === 'en' ? 'Book Now' : 'Rezervēt';
    }
  } catch(err) {
    alert('Savienojuma kludaa. Ludzu, meginet velreiz.');
    submitBtn.disabled = false;
    submitBtn.textContent = window.currentLang === 'en' ? 'Book Now' : 'Rezervēt';
  }
});

const langFlags = {
  lv: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="30" fill="#9e3039"/><rect width="60" height="10" y="10" fill="#fff"/></svg>',
  en: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="30" fill="#012169"/><path d="M0 0l60 30M60 0L0 30" stroke="#fff" stroke-width="6"/><path d="M0 0l60 30M60 0L0 30" stroke="#C8102E" stroke-width="4"/><rect width="8" height="30" x="26" fill="#fff"/><rect width="60" height="8" y="11" fill="#fff"/><rect width="4" height="30" x="28" fill="#C8102E"/><rect width="60" height="4" y="13" fill="#C8102E"/></svg>',
  lt: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="10" fill="#fdb921"/><rect width="60" height="10" y="10" fill="#006a44"/><rect width="60" height="10" y="20" fill="#c1272d"/></svg>',
  et: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="10" fill="#0072ce"/><rect width="60" height="10" y="10" fill="#000"/><rect width="60" height="10" y="20" fill="#fff"/></svg>',
  fi: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="30" fill="#fff"/><rect width="8" height="30" x="14" fill="#003580"/><rect width="60" height="8" y="11" fill="#003580"/></svg>',
};

const langMeta = {
  lv: { name: 'LV', river: '— Izvēlieties upi —', route: '— Vispirms izvēlieties upi —', notes: 'Jebkāda papildu informācija...', firstName: 'Jānis', lastName: 'Bērziņš', email: 'janis@inbox.lv', phoneCode: '+371', phoneCountry: 'LV' },
  en: { name: 'EN', river: '— Select a river —', route: '— First select a river —', notes: 'Any additional information...', firstName: 'John', lastName: 'Smith', email: 'john@gmail.com', phoneCode: '+44', phoneCountry: 'GB' },
  lt: { name: 'LT', river: '— Pasirinkite upę —', route: '— Pirmiausia pasirinkite upę —', notes: 'Bet kokia papildoma informacija...', firstName: 'Jonas', lastName: 'Jonaitis', email: 'jonas@gmail.com', phoneCode: '+370', phoneCountry: 'LT' },
  et: { name: 'ET', river: '— Valige jõgi —', route: '— Kõigepealt valige jõgi —', notes: 'Mis tahes lisateave...', firstName: 'Jaan', lastName: 'Tamm', email: 'jaan@gmail.com', phoneCode: '+372', phoneCountry: 'EE' },
  fi: { name: 'FI', river: '— Valitse joki —', route: '— Valitse ensin joki —', notes: 'Lisätietoja...', firstName: 'Matti', lastName: 'Virtanen', email: 'matti@gmail.com', phoneCode: '+358', phoneCountry: 'FI' },
};

function setLang(lang) {
  document.querySelectorAll('[data-lv]').forEach(el => {
    const text = el.getAttribute('data-' + lang) || el.getAttribute('data-en');
    if (!text) return;
    if (el.querySelector('.req')) {
      el.childNodes.forEach(n => { if (n.nodeType === 3) n.textContent = text + ' '; });
    } else {
      el.textContent = text;
    }
  });

  const m = langMeta[lang];
  document.getElementById('notes').placeholder = m.notes;
  document.getElementById('firstName').placeholder = m.firstName;
  document.getElementById('lastName').placeholder = m.lastName;
  document.getElementById('email').placeholder = m.email;
  selectCountry(m.phoneCode, m.phoneCountry);

  const riverEl = document.getElementById('river');
  const routeEl = document.getElementById('route');
  if (riverEl.options[0]) riverEl.options[0].text = m.river;
  if (routeEl.options[0]) routeEl.options[0].text = m.route;

  document.getElementById('currentLangFlag').innerHTML = langFlags[lang];
  document.getElementById('currentLangName').textContent = m.name;

  document.querySelectorAll('.lang-option').forEach(opt => {
    opt.classList.toggle('active', opt.getAttribute('onclick') === `setLang('${lang}')`);
  });

  document.getElementById('langDropdownMenu').classList.remove('open');
  window.currentLang = lang;
}

function toggleLangMenu() {
  document.getElementById('langDropdownMenu').classList.toggle('open');
}

document.addEventListener('click', e => {
  if (!e.target.closest('.lang-select-wrap')) {
    document.getElementById('langDropdownMenu').classList.remove('open');
  }
});

window.currentLang = 'lv';

// SVG flags
const flagSVGs = {
  LV: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="30" fill="#9e3039"/><rect width="60" height="10" y="10" fill="#fff"/></svg>',
  LT: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="10" fill="#fdb921"/><rect width="60" height="10" y="10" fill="#006a44"/><rect width="60" height="10" y="20" fill="#c1272d"/></svg>',
  EE: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="10" fill="#0072ce"/><rect width="60" height="10" y="10" fill="#000"/><rect width="60" height="10" y="20" fill="#fff"/></svg>',
  FI: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="30" fill="#fff"/><rect width="8" height="30" x="14" fill="#003580"/><rect width="60" height="8" y="11" fill="#003580"/></svg>',
  SE: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="30" fill="#006aa7"/><rect width="8" height="30" x="14" fill="#fecc02"/><rect width="60" height="8" y="11" fill="#fecc02"/></svg>',
  NO: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="30" fill="#ef2b2d"/><rect width="8" height="30" x="14" fill="#fff"/><rect width="60" height="8" y="11" fill="#fff"/><rect width="4" height="30" x="16" fill="#002868"/><rect width="60" height="4" y="13" fill="#002868"/></svg>',
  DK: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="30" fill="#c60c30"/><rect width="6" height="30" x="12" fill="#fff"/><rect width="60" height="6" y="12" fill="#fff"/></svg>',
  DE: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="10" fill="#000"/><rect width="60" height="10" y="10" fill="#d00"/><rect width="60" height="10" y="20" fill="#ffce00"/></svg>',
  GB: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="30" fill="#012169"/><path d="M0 0l60 30M60 0L0 30" stroke="#fff" stroke-width="6"/><path d="M0 0l60 30M60 0L0 30" stroke="#C8102E" stroke-width="4"/><rect width="8" height="30" x="26" fill="#fff"/><rect width="60" height="8" y="11" fill="#fff"/><rect width="4" height="30" x="28" fill="#C8102E"/><rect width="60" height="4" y="13" fill="#C8102E"/></svg>',
  NL: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="10" fill="#ae1c28"/><rect width="60" height="10" y="10" fill="#fff"/><rect width="60" height="10" y="20" fill="#21468b"/></svg>',
  PL: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="15" fill="#fff"/><rect width="60" height="15" y="15" fill="#dc143c"/></svg>',
  FR: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="20" height="30" fill="#002395"/><rect width="20" height="30" x="20" fill="#fff"/><rect width="20" height="30" x="40" fill="#ed2939"/></svg>',
  IT: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="20" height="30" fill="#009246"/><rect width="20" height="30" x="20" fill="#fff"/><rect width="20" height="30" x="40" fill="#ce2b37"/></svg>',
  ES: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="30" fill="#c60b1e"/><rect width="60" height="16" y="7" fill="#ffc400"/></svg>',
  US: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="30" fill="#fff"/><rect width="60" height="2.3" fill="#B22234"/><rect width="60" height="2.3" y="4.6" fill="#B22234"/><rect width="60" height="2.3" y="9.2" fill="#B22234"/><rect width="60" height="2.3" y="13.8" fill="#B22234"/><rect width="60" height="2.3" y="18.4" fill="#B22234"/><rect width="60" height="2.3" y="23.1" fill="#B22234"/><rect width="60" height="2.3" y="27.7" fill="#B22234"/><rect width="24" height="16" fill="#3C3B6E"/></svg>',
  RU: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="10" fill="#fff"/><rect width="60" height="10" y="10" fill="#0039A6"/><rect width="60" height="10" y="20" fill="#D52B1E"/></svg>',
  UA: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="15" fill="#005bbb"/><rect width="60" height="15" y="15" fill="#ffd500"/></svg>',
  BY: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="20" fill="#cf101a"/><rect width="60" height="10" y="20" fill="#007629"/></svg>',
  AT: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="10" fill="#ed2939"/><rect width="60" height="10" y="10" fill="#fff"/><rect width="60" height="10" y="20" fill="#ed2939"/></svg>',
  CH: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="12" height="12" style="border-radius:2px"><rect width="32" height="32" fill="#d52b1e"/><rect width="6" height="20" x="13" y="6" fill="#fff"/><rect width="20" height="6" x="6" y="13" fill="#fff"/></svg>',
  BE: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="20" height="30" fill="#000"/><rect width="20" height="30" x="20" fill="#FFD90C"/><rect width="20" height="30" x="40" fill="#F00"/></svg>',
  CZ: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="15" fill="#fff"/><rect width="60" height="15" y="15" fill="#d7141a"/><polygon points="0,0 30,15 0,30" fill="#11457e"/></svg>',
  SK: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="10" fill="#fff"/><rect width="60" height="10" y="10" fill="#0b4ea2"/><rect width="60" height="10" y="20" fill="#ee1c25"/></svg>',
  HU: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="10" fill="#ce2939"/><rect width="60" height="10" y="10" fill="#fff"/><rect width="60" height="10" y="20" fill="#477050"/></svg>',
  RO: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="20" height="30" fill="#002B7F"/><rect width="20" height="30" x="20" fill="#FCD116"/><rect width="20" height="30" x="40" fill="#CE1126"/></svg>',
  CA: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="15" height="30" fill="#FF0000"/><rect width="30" height="30" x="15" fill="#fff"/><rect width="15" height="30" x="45" fill="#FF0000"/></svg>',
  AU: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="30" fill="#00008B"/></svg>',
  JP: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="30" fill="#fff"/><circle cx="30" cy="15" r="9" fill="#BC002D"/></svg>',
  CN: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="30" fill="#DE2910"/></svg>',
  IN: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="12" style="border-radius:2px"><rect width="60" height="10" fill="#FF9933"/><rect width="60" height="10" y="10" fill="#fff"/><rect width="60" height="10" y="20" fill="#138808"/></svg>',
};

function getFlag(code) {
  return flagSVGs[code] || '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 12" width="24" height="12" style="border-radius:2px"><rect width="24" height="12" fill="#ddd"/></svg>';
}

const countries = [
  {name:'Latvia',code:'LV',prefix:'+371'},
  {name:'Lithuania',code:'LT',prefix:'+370'},
  {name:'Estonia',code:'EE',prefix:'+372'},
  {name:'Finland',code:'FI',prefix:'+358'},
  {name:'Sweden',code:'SE',prefix:'+46'},
  {name:'Norway',code:'NO',prefix:'+47'},
  {name:'Denmark',code:'DK',prefix:'+45'},
  {name:'Germany',code:'DE',prefix:'+49'},
  {name:'United Kingdom',code:'GB',prefix:'+44'},
  {name:'Netherlands',code:'NL',prefix:'+31'},
  {name:'Poland',code:'PL',prefix:'+48'},
  {name:'Russia',code:'RU',prefix:'+7'},
  {name:'Belarus',code:'BY',prefix:'+375'},
  {name:'France',code:'FR',prefix:'+33'},
  {name:'Italy',code:'IT',prefix:'+39'},
  {name:'Spain',code:'ES',prefix:'+34'},
  {name:'Austria',code:'AT',prefix:'+43'},
  {name:'Switzerland',code:'CH',prefix:'+41'},
  {name:'Belgium',code:'BE',prefix:'+32'},
  {name:'Czech Republic',code:'CZ',prefix:'+420'},
  {name:'Slovakia',code:'SK',prefix:'+421'},
  {name:'Hungary',code:'HU',prefix:'+36'},
  {name:'Romania',code:'RO',prefix:'+40'},
  {name:'Ukraine',code:'UA',prefix:'+380'},
  {name:'United States',code:'US',prefix:'+1'},
  {name:'Canada',code:'CA',prefix:'+1'},
  {name:'Australia',code:'AU',prefix:'+61'},
  {name:'Japan',code:'JP',prefix:'+81'},
  {name:'China',code:'CN',prefix:'+86'},
  {name:'India',code:'IN',prefix:'+91'},
];

function renderCountries(list) {
  const el = document.getElementById('prefixList');
  el.innerHTML = list.map(c => 
    `<div class="prefix-option" onclick="selectCountry('${c.prefix}','${c.code}')">
      ${getFlag(c.code)}
      <span>${c.name}</span>
      <span class="code">${c.prefix}</span>
    </div>`
  ).join('');
}

function selectCountry(prefix, code) {
  document.getElementById('prefixCode').textContent = prefix;
  document.getElementById('prefixFlag').innerHTML = getFlag(code);
  document.getElementById('prefixDropdown').classList.remove('open');
}

function togglePrefixDropdown() {
  const dd = document.getElementById('prefixDropdown');
  dd.classList.toggle('open');
  if (dd.classList.contains('open')) {
    document.getElementById('prefixSearch').focus();
  }
}

function filterCountries(q) {
  const filtered = countries.filter(c => 
    c.name.toLowerCase().includes(q.toLowerCase()) || c.prefix.includes(q)
  );
  renderCountries(filtered);
}

document.addEventListener('click', e => {
  if (!e.target.closest('.phone-field-wrap')) {
    document.getElementById('prefixDropdown').classList.remove('open');
  }
});

renderCountries(countries);
selectCountry('+371', 'LV');
</script>
</body>
</html>
